{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Comments - {{ site_name }}{% endblock %}

{% block content %}
<div class="page-header-section">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div class="page-header-content">
                <h1 class="page-title">
                    <i class="bi bi-chat-square-text"></i>
                    Manage Comments
                </h1>
                <p class="page-subtitle">Review and moderate comments on your posts</p>
            </div>
            <a href="{% url 'accounts:dashboard' %}" class="btn btn-light">
                <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    </div>
</div>

<div class="container py-4">
    <!-- Filter Tabs -->
    <div class="filter-tabs mb-4">
        <a href="{% url 'accounts:manage_comments' %}" class="filter-tab {% if not request.GET.status %}active{% endif %}">
            All Comments
        </a>
        <a href="?status=pending" class="filter-tab {% if request.GET.status == 'pending' %}active{% endif %}">
            Pending
        </a>
        <a href="?status=approved" class="filter-tab {% if request.GET.status == 'approved' %}active{% endif %}">
            Approved
        </a>
    </div>

    <!-- Comments List -->
    <div class="comments-container">
        {% for comment in comments %}
        <div class="comment-card {% if not comment.is_approved %}pending{% endif %}">
            <div class="comment-header">
                <div class="comment-avatar">
                    {{ comment.author.username|slice:":1"|upper }}
                </div>
                <div class="comment-info">
                    <strong>{{ comment.author.username }}</strong>
                    <span class="text-muted">commented on</span>
                    <a href="{{ comment.post.get_absolute_url }}">{{ comment.post.title }}</a>
                </div>
                <span class="badge {% if comment.is_approved %}bg-success{% else %}bg-warning text-dark{% endif %}">
                    {% if comment.is_approved %}Approved{% else %}Pending{% endif %}
                </span>
            </div>
            <div class="comment-body">
                <p>{{ comment.content }}</p>
                <small class="text-muted">{{ comment.created_at|date:"M d, Y \a\t h:i A" }}</small>
            </div>
            <div class="comment-actions">
                {% if not comment.is_approved %}
                <form method="POST" action="{% url 'accounts:comment_action' comment.pk %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="approve">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-check-lg me-1"></i>Approve
                    </button>
                </form>
                {% else %}
                <form method="POST" action="{% url 'accounts:comment_action' comment.pk %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="reject">
                    <button type="submit" class="btn btn-outline-warning">
                        <i class="bi bi-x-lg me-1"></i>Reject
                    </button>
                </form>
                {% endif %}
                <form method="POST" action="{% url 'accounts:comment_action' comment.pk %}" class="d-inline"
                      onsubmit="return confirm('Are you sure you want to delete this comment?');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="btn btn-outline-danger">
                        <i class="bi bi-trash me-1"></i>Delete
                    </button>
                </form>
            </div>
        </div>
        {% empty %}
        <div class="empty-state-card">
            <div class="empty-icon">
                <i class="bi bi-chat-square"></i>
            </div>
            <h3>No Comments</h3>
            <p>There are no comments to display.</p>
            <a href="{% url 'accounts:dashboard' %}" class="btn btn-primary">
                Back to Dashboard
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .page-header-section {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        padding: 2rem 0;
        color: white;
    }

    .page-header-content { color: white; }

    .page-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .page-subtitle {
        color: rgba(255, 255, 255, 0.8);
        margin: 0;
    }

    /* Filter Tabs */
    .filter-tabs {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .filter-tab {
        padding: 0.625rem 1.25rem;
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius);
        color: var(--gray-600);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
    }

    .filter-tab:hover {
        border-color: var(--primary);
        color: var(--primary);
    }

    .filter-tab.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    /* Comments Container */
    .comments-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .comment-card {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
    }

    .comment-card.pending {
        border-left: 4px solid var(--warning);
    }

    .comment-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .comment-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        flex-shrink: 0;
    }

    .comment-info {
        flex: 1;
        min-width: 200px;
    }

    .comment-info a {
        color: var(--primary);
        font-weight: 500;
    }

    .comment-body {
        margin-bottom: 1rem;
        padding-left: 3.5rem;
    }

    .comment-body p {
        color: var(--gray-700);
        line-height: 1.6;
        margin-bottom: 0.5rem;
    }

    .comment-actions {
        display: flex;
        gap: 0.5rem;
        padding-left: 3.5rem;
        flex-wrap: wrap;
    }

    /* Empty State */
    .empty-state-card {
        background: white;
        border-radius: var(--radius-xl);
        padding: 4rem 2rem;
        text-align: center;
        box-shadow: var(--shadow);
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
    }

    .empty-icon i {
        font-size: 2.5rem;
        color: var(--gray-400);
    }

    .empty-state-card h3 {
        color: var(--gray-800);
        margin-bottom: 0.5rem;
    }

    .empty-state-card p {
        color: var(--gray-500);
        margin-bottom: 1.5rem;
    }

    @media (max-width: 767.98px) {
        .comment-body, .comment-actions {
            padding-left: 0;
        }

        .comment-header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}
